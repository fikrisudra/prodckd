<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Daily Checklist Control Panel Operator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body style="background: var(--bg);">
    <div id="toast-container" class="toast-container"></div>

    <header class="app-header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="ri-arrow-left-line" onclick="window.location.href='main.html'" style="font-size: 24px; cursor: pointer;"></i>
            <h2 style="font-weight: 800; font-size: 18px;">Checklist Control Panel</h2>
        </div>
    </header>

    <div class="dashboard-content">
        <div class="content-section">
            <div class="info-card">
                <form id="checklistForm">
                    <div class="input-box">
                        <label>SHIFT</label>
                        <select id="shift" class="custom-select">
                            <option value="1">SHIFT 1</option>
                            <option value="2">SHIFT 2</option>
                            <option value="3">SHIFT 3</option>
                        </select>
                    </div>

                    <div class="input-box">
                        <label>SUPERVISOR ON DUTY</label>
                        <input type="text" id="supervisor" placeholder="Nama Supervisor" required>
                    </div>

                    <hr class="form-divider">

                    <div id="questions-container">
                        <script>
                            const questions = [
                                "Apakah resep sudah diprint dan dicek sesuai dengan order produksi PPIC?",
                                "Cek screen HM Post dan HM Pre pastikan sesuai pakan yang akan di produksi",
                                "Pastikan line dosing dalam keadaan normal dan aman",
                                "Cek stok bin press dan bin finish",
                                "Apakah stok bahan baku dan hand add sudah terpenuhi sesuai order produksi",
                                "Apakah pemakaian bahan baku sudah sesuai FIFO dan RBRM (rigth bin right material)",
                                "Periksa particle size after HM Post, HM Pre dan after Mixer",
                                "Bersihkan magnet 325 dan 377",
                                "Bersihkan magnet HM Post dan HM Pre",
                                "Apakah hand add yang dicurah sesuai dengan pakan yang diproduksi",
                                "Apakah tidak ada penyimpangan penimbangan bahan baku (jika ada atasi sesuai prosedur)",
                                "Apakah mixing time sesuai dengan standar QC"
                            ];

                            questions.forEach((q, i) => {
                                document.write(`
                                    <div class="check-group">
                                        <label>${i+1}. ${q}</label>
                                        <div class="options">
                                            <label><input type="radio" name="q${i+1}" value="Ya" required><div class="opt yes">YA</div></label>
                                            <label><input type="radio" name="q${i+1}" value="Tidak"><div class="opt no">TIDAK</div></label>
                                        </div>
                                    </div>
                                `);
                            });
                        </script>
                    </div>

                    <button type="submit" id="submitBtn" class="btn-login" style="margin-top: 20px;">KIRIM LAPORAN</button>
                </form>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.getElementById('checklistForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const session = JSON.parse(localStorage.getItem('userSession')) || { name: "Guest" };
            
            btn.disabled = true;
            btn.innerHTML = '<i class="ri-loader-4-line ri-spin"></i> MENGIRIM...';

            const payload = {
                tanggal: new Date().toLocaleDateString('id-ID'),
                shift: document.getElementById('shift').value,
                operator: session.name,
                supervisor: document.getElementById('supervisor').value,
                tglDibuat: new Date().toLocaleString('id-ID')
            };

            // Menambah hasil Q1 - Q12 ke payload
            for(let i=1; i<=12; i++) {
                payload['q'+i] = document.querySelector(`input[name="q${i}"]:checked`).value;
            }

            try {
                // Menggunakan URL Checklist yang ada di script.js
                await fetch(SCRIPT_URL_CHECKLIST, {
                    method: 'POST',
                    mode: 'no-cors', // Mode paling aman untuk Apps Script
                    body: JSON.stringify(payload)
                });
                
                showToast("Berhasil", "Laporan telah masuk ke spreadsheet", "success");
                setTimeout(() => { window.location.href = 'main.html'; }, 2000);
            } catch (err) {
                alert("Gagal mengirim: " + err.message);
                btn.disabled = false;
                btn.innerText = "KIRIM LAPORAN";
            }
        });
    </script>
</body>
</html>
